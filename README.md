# Respostas Sql

/* Banco de Dados */ 

CREATE DATABASE DRLAVATUDO;
USE DRLAVATUDO;

CREATE TABLE CLIENTE(
ID INT UNSIGNED NOT NULL,
NOME VARCHAR(60) NOT NULL,
EMAIL VARCHAR(80) NOT NULL,
DATA_DE_NASCIMENTO DATE NOT NULL,
TELEFONE_CELULAR CHAR(15) NOT NULL,
TELEFONE_RESIDENCIAL CHAR(14) NOT NULL,
PRIMARY KEY(ID)
);

CREATE TABLE SERVICOS(
ID INT AUTO_INCREMENT NOT NULL, 
NOME_SERVICO VARCHAR(60) NOT NULL, 
VALOR_FINAL DOUBLE(9,2) NOT NULL, 
CUSTO_EMPRESA DOUBLE(9,2) NOT NULL,
PRIMARY KEY(ID)
);

CREATE TABLE ORDEM_DE_SERVICO(
ID INT AUTO_INCREMENT NOT NULL,
ID_CLIENTE INT NOT NULL, 
ID_SERVICO INT NOT NULL, 
DATA_CONTRATACAO DATE NOT NULL, 
DATA_EXECUCAO DATE NOT NULL, 
PRIMARY KEY(ID),
FOREIGN KEY(ID_CLIENTE) REFERENCES CLIENTE(ID),
FOREIGN KEY(ID_SERVICO) REFERENCES SERVICOS(ID)
);

/* Problema 1 */

USE DRLAVATUDO;

CREATE TABLE ORDEM_DE_SERVICO_SERVICOS(
ID INT AUTO_INCREMENT NOT NULL,
ID_ORDEM_DE_SERVICO INT NOT NULL,
ID_SERVICOS INT NOT NULL,
PRIMARY KEY(ID),
FOREIGN KEY(ID_ORDEM_DE_SERVICO) REFERENCES ORDEM_DE_SERVICO(ID),
FOREIGN KEY(ID_SERVICOS) REFERENCES SERVICOS(ID)
);

ALTER TABLE ORDEM_DE_SERVICO
DROP COLUMN ID_SERVICO;

/* Problema 2 */

USE DRLAVATUDO;

ALTER TABLE ORDEM_DE_SERVICO_SERVICOS
ADD ENDERECO_RUA VARCHAR(30) NOT NULL,
ADD	ENDERECO_NUMERO INT NOT NULL,
ADD ENDERECO_COMPLEMENTO VARCHAR(10),
ADD ENDERECO_BAIRRO VARCHAR(30) NOT NULL,
ADD ENDERECO_CIDADE VARCHAR(30) NOT NULL,
ADD ENDERECO_ESTADO CHAR(2) NOT NULL;

/* usuário deverá digitar o endereço a cada serviço da ordem de serviço */

/* Problema 3 */ 

USE DRLAVATUDO;

/*a. Selecione todos os clientes e a quantidade de ordem de serviços*/

SELECT 
	CLIENTE.ID,
	CLIENTE.NOME,
    COUNT(ORDEM_DE_SERVICO.ID_CLIENTE) 
FROM 
	CLIENTE JOIN ORDEM_DE_SERVICO ON CLIENTE.ID = ORDEM_DE_SERVICO.ID_CLIENTE
GROUP BY 
	CLIENTE.ID;

/*b. Selecione todas as Ordens de Serviços com mais de um serviço*/

SELECT 
    ORDEM_DE_SERVICO.ID
FROM
    ORDEM_DE_SERVICO JOIN ORDEM_DE_SERVICO_SERVICOS ON ORDEM_DE_SERVICO.ID = ORDEM_DE_SERVICO_SERVICOS.ID_ORDEM_DE_SERVICO
GROUP BY 
	ORDEM_DE_SERVICO.ID
HAVING
	COUNT(ORDEM_DE_SERVICO_SERVICOS.ID_ORDEM_DE_SERVICO) > 1;


/*c. Selecione os serviços mais vendidos */

SELECT
	SERVICOS.NOME_SERVICO,
    COUNT(ORDEM_DE_SERVICO_SERVICOS.ID_SERVICOS)
FROM
	SERVICOS JOIN ORDEM_DE_SERVICO_SERVICOS ON SERVICOS.ID = ORDEM_DE_SERVICO_SERVICOS.ID_SERVICOS
GROUP BY
	SERVICOS.NOME_SERVICO
ORDER BY
	COUNT(ORDEM_DE_SERVICO_SERVICOS.ID_SERVICOS) DESC, SERVICOS.NOME_SERVICO;
    
/*d. Atualize o valor final de todos os serviços em 12%*/

UPDATE SERVICOS SET SERVICOS.VALOR_FINAL = (SERVICOS.VALOR_FINAL * 12 / 100) + SERVICOS.VALOR_FINAL;

/*e. Remova a ultima ordem de serviço criada */

DELETE FROM ORDEM_DE_SERVICO ORDER BY ORDEM_DE_SERVICO.ID DESC LIMIT 1;

/*f. Insira um cliente */

INSERT INTO `drlavatudo`.`cliente` (`ID`, `NOME`, `EMAIL`, `DATA_DE_NASCIMENTO`, `TELEFONE_CELULAR`, `TELEFONE_RESIDENCIAL`) VALUES ('5', 'FRANCO', 'FRANCO@GMAIL.COM', '1994-05-02', '(31) 99475-1248', '(31) 3587-9894');
